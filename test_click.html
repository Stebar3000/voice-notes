<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Voice Notes Auto</title>
    
    <!-- PWA Meta Tags per migliore integrazione mobile -->
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Voice Notes">
    
    <!-- Manifest corretto per GitHub Pages -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVm9pY2UgTm90ZXMgQXV0byIsInNob3J0X25hbWUiOiJWb2ljZU5vdGVzIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTI5M2IiLCJ0aGVtZV9jb2xvciI6IiMyNTYzZWIiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpRaUlHaGxhV2RvZEQwaU1qUWlJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlOQ0lnYm1GdFpYTndZV05sUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BIQmhkR2dnWkQwaVRUZ2dNVE5oTlNBMUlEQWdNUzR4SURFZ01URWdNaVl6SURBZ01URTRNaTQzTlNBek5pNHlOQ0EyTlM0ME15QTFOQ0EwTGpVNElEQWdNUzQ0TGpGaE5TQTFJREFnTUNBMExqVWdNell1TWpSYU1UZ2dNVE52TFRJZ01UQmhOaUEySUdGYU1EQTVMVFV1TVVFMU5TQTFJREFnTUNBNUlGUnRNQ0EzWXpBZ01TNDNMaTQwSUVNZ01UUWdNVzV2TVMweUlERXdMaTQySUZObE56QXVOelVnTUNBNUlEVjFMalZoTmkwMklEZ2dPV0ZhSWlCbWFXeHNQU0lqWVdOaVkya2lMejQ4TDNOMlp6ND0iLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    
    <!-- Favicon inline per evitare richieste esterne -->
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgbmFtZXNwYWNlPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTggMTNhNSA1IDAgMCAxIDEwIDJsMyAwIDAgMTE4Mi43NSAzNi4yNCA2NS40MyA1NCA0LjU4IDAgMS44LjFhNSA1IDAgMCAwIDQuNSAzNi4yNFoiIGZpbGw9IiNhY2JjZyIvPjwvc3ZnPg==">
    
    <style>
        /* Reset e configurazione base ottimizzata per mobile */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation; /* Previene zoom accidentali */
            -webkit-tap-highlight-color: transparent; /* Rimuove highlight su tap iOS */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            user-select: none;
            overflow: hidden;
            /* Migliore rendering su iOS */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            text-align: center;
            padding: 20px;
            width: 100%;
            max-width: 600px;
            /* Sicurezza per notch iPhone */
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }

        .status-text {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 2rem;
            height: 80px; /* Pi√π spazio per messaggi multiriga */
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            text-align: center;
            line-height: 1.3;
        }

        .record-button {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: none;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            /* Ottimizzazioni per touch */
            -webkit-user-select: none;
            user-select: none;
        }

        .record-button.idle {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .record-button.recording {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: pulse 1.5s infinite;
        }

        .record-button.paused {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .record-button.error {
            background: linear-gradient(135deg, #94a3b8, #64748b);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .record-button:active {
            transform: scale(0.95);
        }

        .timer {
            font-size: 1.5rem;
            font-weight: 500;
            color: #e2e8f0;
            margin-bottom: 1rem;
            font-variant-numeric: tabular-nums; /* Numeri allineati */
        }

        /* Stili aggiuntivi per controlli e note - versione ridotta */
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            color: #94a3b8;
            text-align: center;
            max-width: 90%;
            bottom: max(20px, env(safe-area-inset-bottom));
        }

        /* Responsive design */
        @media (max-width: 480px) {
            .record-button {
                width: 250px;
                height: 250px;
                font-size: 1.8rem;
            }
            
            .status-text {
                font-size: 1.4rem;
                margin-bottom: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-text" id="statusText">Pronto per registrare</div>
        
        <div class="timer" id="timer">00:00</div>
        
        <!-- Indicatore di versione AGGIORNATO -->
        <div style="position: absolute; top: 10px; right: 10px; font-size: 0.8rem; color: #94a3b8; opacity: 0.8;">
            v1.4-click-fix
        </div>
        
        <button class="record-button idle" id="recordButton">
            <span id="buttonText">INIZIA</span>
        </button>
    </div>
    
    <div class="instructions">
        Click: Inizia/Pausa/Riprendi ‚Ä¢ Doppio Click: Salva e chiudi nota<br>
        <small style="color: #64748b;">Versione semplificata per test funzionalit√† click</small>
    </div>

    <script>
        // VERSIONE SEMPLIFICATA PER TEST CLICK - v1.4-click-fix
        class VoiceNotesApp {
            constructor() {
                console.log('üöÄ Voice Notes App v1.4-click-fix inizializzata');
                
                // Stato dell'applicazione
                this.isRecording = false;
                this.isPaused = false;
                this.hasError = false;
                
                // Gestione doppio click
                this.lastClickTime = 0;
                this.doubleClickDelay = 400;
                this.clickTimeout = null;
                
                // Inizializza elementi e eventi
                this.initializeElements();
                this.attachEventListeners();
                this.updateUI();
                
                console.log('‚úÖ Inizializzazione completata - pulsante dovrebbe rispondere ai click');
            }
            
            initializeElements() {
                // Elementi DOM principali
                this.recordButton = document.getElementById('recordButton');
                this.statusText = document.getElementById('statusText');
                this.buttonText = document.getElementById('buttonText');
                this.timer = document.getElementById('timer');
                
                // Verifica che tutti gli elementi esistano
                if (!this.recordButton || !this.statusText || !this.buttonText || !this.timer) {
                    console.error('‚ùå Errore: Elementi DOM non trovati');
                    this.showError('Errore inizializzazione', 'Ricarica la pagina');
                    return false;
                }
                
                console.log('‚úÖ Elementi DOM inizializzati correttamente');
                return true;
            }
            
            attachEventListeners() {
                // CORREZIONE PRINCIPALE: Event listeners correttamente collegati
                if (!this.recordButton) {
                    console.error('‚ùå Errore: recordButton non disponibile per event listeners');
                    return;
                }
                
                // Click handler principale - CORRETTO
                this.recordButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('üéØ Click rilevato sul pulsante!');
                    this.handleButtonClick();
                });
                
                // Touch handlers per mobile - CORRETTI
                this.recordButton.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    console.log('üì± Touch start rilevato');
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                });
                
                this.recordButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    console.log('üì± Touch end rilevato');
                    this.handleButtonClick();
                });
                
                // Previeni comportamenti indesiderati
                this.recordButton.addEventListener('touchmove', (e) => e.preventDefault());
                this.recordButton.addEventListener('selectstart', (e) => e.preventDefault());
                
                console.log('‚úÖ Event listeners collegati correttamente');
            }
            
            handleButtonClick() {
                console.log('üéØ handleButtonClick chiamata - stato:', {
                    isRecording: this.isRecording,
                    isPaused: this.isPaused,
                    hasError: this.hasError
                });
                
                // Gestione errori
                if (this.hasError) {
                    this.resetErrorState();
                    return;
                }
                
                const currentTime = Date.now();
                
                // Clear timeout precedente
                if (this.clickTimeout) {
                    clearTimeout(this.clickTimeout);
                    this.clickTimeout = null;
                }
                
                // Gestione doppio click
                if (currentTime - this.lastClickTime < this.doubleClickDelay) {
                    console.log('üéØ Doppio click rilevato');
                    this.handleDoubleClick();
                    this.lastClickTime = 0;
                } else {
                    // Aspetta per vedere se arriva un secondo click
                    this.clickTimeout = setTimeout(() => {
                        console.log('üéØ Click singolo processato');
                        this.handleSingleClick();
                        this.clickTimeout = null;
                    }, this.doubleClickDelay);
                    this.lastClickTime = currentTime;
                }
            }
            
            handleSingleClick() {
                console.log('üéØ handleSingleClick - transizione stato');
                
                if (!this.isRecording && !this.isPaused) {
                    this.startRecording();
                } else if (this.isRecording) {
                    this.pauseRecording();
                } else if (this.isPaused) {
                    this.resumeRecording();
                }
            }
            
            handleDoubleClick() {
                console.log('üéØ handleDoubleClick - stop e salva');
                
                if (this.isRecording || this.isPaused) {
                    this.stopAndSaveRecording();
                }
            }
            
            startRecording() {
                console.log('üéôÔ∏è Avvio registrazione (simulata)');
                this.isRecording = true;
                this.isPaused = false;
                this.hasError = false;
                this.updateUI();
                
                // Simula feedback utente
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }
            
            pauseRecording() {
                console.log('‚è∏Ô∏è Pausa registrazione');
                this.isRecording = false;
                this.isPaused = true;
                this.updateUI();
            }
            
            resumeRecording() {
                console.log('‚ñ∂Ô∏è Ripresa registrazione');
                this.isRecording = true;
                this.isPaused = false;
                this.updateUI();
            }
            
            stopAndSaveRecording() {
                console.log('‚èπÔ∏è Stop e salvataggio');
                this.isRecording = false;
                this.isPaused = false;
                this.updateUI();
                
                // Simula salvataggio
                this.showStatus('‚úÖ Nota salvata! (simulazione)');
                setTimeout(() => {
                    this.showStatus('Pronto per registrare');
                }, 2000);
            }
            
            resetErrorState() {
                console.log('üîÑ Reset stato errore');
                this.hasError = false;
                this.showStatus('Pronto per registrare');
                this.updateUI();
            }
            
            updateUI() {
                // Reset classi CSS
                this.recordButton.className = 'record-button';
                
                if (this.hasError) {
                    this.recordButton.classList.add('error');
                    this.buttonText.textContent = 'RIPROVA';
                    this.showStatus('Errore - Click per riprovare');
                } else if (this.isRecording) {
                    this.recordButton.classList.add('recording');
                    this.buttonText.textContent = 'PAUSA';
                    this.showStatus('üî¥ Registrando... (simulato)');
                } else if (this.isPaused) {
                    this.recordButton.classList.add('paused');
                    this.buttonText.textContent = 'RIPRENDI';
                    this.showStatus('‚è∏Ô∏è In pausa - Click per continuare');
                } else {
                    this.recordButton.classList.add('idle');
                    this.buttonText.textContent = 'INIZIA';
                    this.showStatus('Pronto per registrare');
                }
                
                console.log('üé® UI aggiornata - stato:', {
                    classes: this.recordButton.className,
                    text: this.buttonText.textContent,
                    status: this.statusText.textContent
                });
            }
            
            showStatus(message) {
                this.statusText.textContent = message;
            }
            
            showError(title, description) {
                this.hasError = true;
                this.statusText.innerHTML = `
                    <div style="color: #fca5a5; font-size: 1.2rem;">${title}</div>
                    <div style="font-size: 0.9rem; margin-top: 8px; color: #cbd5e1; line-height: 1.3;">${description}</div>
                `;
                this.updateUI();
            }
        }
        
        // INIZIALIZZAZIONE CORRETTA - Assicura che il DOM sia pronto
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM Content Loaded - inizializzo app');
            
            // Piccolo delay per sicurezza
            setTimeout(() => {
                try {
                    window.voiceNotesApp = new VoiceNotesApp();
                    console.log('üéâ App inizializzata con successo!');
                } catch (error) {
                    console.error('‚ùå Errore inizializzazione app:', error);
                }
            }, 100);
        });
        
        // Fallback se DOMContentLoaded non funziona
        if (document.readyState === 'loading') {
            console.log('üìÑ DOM ancora in caricamento - attendo DOMContentLoaded');
        } else {
            console.log('üìÑ DOM gi√† pronto - inizializzo immediatamente');
            setTimeout(() => {
                if (!window.voiceNotesApp) {
                    window.voiceNotesApp = new VoiceNotesApp();
                }
            }, 50);
        }
    </script>
</body>
</html>
